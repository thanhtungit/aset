/*
 Copyright (c)2014-2018 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license     GNU GPL version 3 or later
*/
if("undefined"===typeof akeeba)var akeeba={};"undefined"===typeof akeeba.Restore&&(akeeba.Restore={lastResponseSeconds:0,timer:0,errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null,password:null,ajaxURL:null,mainURL:null,translations:{}});
akeeba.Restore.errorCallbackDefault=function(a){document.getElementById("restoration-progress").style.display="none";document.getElementById("restoration-error").style.display="block";document.getElementById("backup-error-message").innerHTML=a};
akeeba.Restore.doAjax=function(a,b,c){json=JSON.stringify(a);a={json:json};0<akeeba.Restore.password.length&&(a.password=akeeba.Restore.password);var g=(new Date).getTime()/1E3,h=parseInt(g,10);a._cacheBustingJunk=Math.round(1E3*(g-h));akeeba.Ajax.ajax({type:"POST",url:akeeba.Restore.ajaxURL,cache:!1,data:a,timeout:6E5,success:function(a){var d="",e=a.indexOf("###");if(-1==e)a="Invalid AJAX data: "+a,null==c?null!=akeeba.Restore.errorCallback?akeeba.Restore.errorCallback(a):akeeba.Restore.errorCallbackDefault(a):
c(a);else{0!=e?(a.substr(0,e),d=a.substr(e)):d=a;d=d.substr(3);e=d.lastIndexOf("###");d=d.substr(0,e);try{var f=JSON.parse(d)}catch(g){errorMessage=g.message+"\n<br/>\n<pre>\n"+d+"\n</pre>";null==c?null!=akeeba.Restore.errorCallback?akeeba.Restore.errorCallback(errorMessage):akeeba.Restore.errorCallbackDefault(errorMessage):c(errorMessage);return}b(f)}},error:function(a,b,e){e=a.responseText?a.responseText:"";var f="<strong>AJAX Loading Error</strong><br/>HTTP Status: "+a.status+" ("+a.statusText+
")<br/>",f=f+"Internal status: "+b+"<br/>XHR ReadyState: "+a.readyState+"<br/>",f=f+"Raw server response:<br/>"+akeeba.System.sanitizeErrorMessage(e);null==c?null!=akeeba.Restore.errorCallback?akeeba.Restore.errorCallback(f):akeeba.Restore.errorCallbackDefault(f):c(f)}})};
akeeba.Restore.startTimeoutBar=function(a,b){akeeba.Restore.resetTimeoutBar();akeeba.Restore.timer=setInterval(function(){akeeba.Restore.lastResponseSeconds++;var a=akeeba.Restore.translations.COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE.replace("%s",akeeba.Restore.lastResponseSeconds.toFixed(0));try{document.getElementById("response-timer div.text").textContent=a}catch(b){}},1E3)};
akeeba.Restore.resetTimeoutBar=function(){akeeba.Restore.lastResponseSeconds=0;if(0!=akeeba.Restore.timer){clearInterval(akeeba.Restore.timer);akeeba.Restore.timer=0;var a=document.getElementById("response-timer").querySelector("div.text"),b=akeeba.Restore.translations.COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE.replace("%s","0");try{a.textContent=b}catch(c){}}};
akeeba.Restore.pingRestoration=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax({task:"ping"},function(a){akeeba.Restore.start(a)})};akeeba.Restore.start=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax({task:"startRestore"},function(a){akeeba.Restore.step(a)})};
akeeba.Restore.step=function(a){akeeba.Restore.resetTimeoutBar();if(!1==a.status)akeeba.Restore.errorCallbackDefault(a.message);else if(a.done)akeeba.Restore.factory=a.factory,document.getElementById("restoration-progress").style.display="none",document.getElementById("restoration-extract-ok").style.display="block";else{akeeba.Restore.statistics.inbytes+=a.bytesIn;akeeba.Restore.statistics.outbytes+=a.bytesOut;akeeba.Restore.statistics.files+=a.files;try{document.getElementById("extbytesin").textContent=
akeeba.Restore.statistics.inbytes,document.getElementById("extbytesout").textContent=akeeba.Restore.statistics.outbytes,document.getElementById("extfiles").textContent=akeeba.Restore.statistics.files}catch(b){}post={task:"stepRestore",factory:a.factory};akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax(post,function(a){akeeba.Restore.step(a)})}};
akeeba.Restore.finalize=function(){var a={task:"finalizeRestore",factory:akeeba.Restore.factory};akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax(a,function(a){akeeba.Restore.finished(a)})};akeeba.Restore.finished=function(){window.location=akeeba.Restore.mainURL};
akeeba.Restore.runInstaller=function(a){window.open(a+"/installation/index.php","abiinstaller");a=document.getElementById("restoration-runinstaller");var b=document.getElementById("restoration-finalize");a.className="akeeba-btn--grey--small";b.style.display="block"};akeeba.Restore.restoreDefaultOptions=function(){var a=document.getElementById("jps_key");a&&(a.value="ChromeIsDumb",a.value="")};
akeeba.Restore.onProcEngineChange=function(a){a=document.getElementById("procengine").value;var b=document.getElementById("ftpOptions"),c=document.getElementById("ftp_test");b.style.display="none";c.style.display="none";"direct"!=a&&(b.style.display="block",c.style.display="inline-block")}; //#sourceMappingURL=restore.min.map
